#!/usr/bin/env python
# -*- coding: utf-8 -*-
# generated by wxGlade 0.6.3 on Tue Mar 23 21:59:58 2010

import gettext
import platform
import os

import wx

from core.config import GeneralConfig, getConfigPath
import core.system


class OutWiker(wx.App):
	def __init__(self, *args, **kwds):
		self._configFileName = getConfigPath (u".outwiker", u"outwiker.ini")
		self.config = GeneralConfig (self._configFileName)
		wx.App.__init__ (self, *args, **kwds)


	def __initLocale (self):
		# Кусок кода взят отсюда - http://wiki.wxpython.org/Internationalization
		language = self.config.languageOption.value

		locales = {
			u"en" : (wx.LANGUAGE_ENGLISH, u"en_US.UTF-8"),
			u"ru" : (wx.LANGUAGE_RUSSIAN, u"ru_RU.UTF-8"),
			}

		try:
			mylocale = wx.Locale (locales[language][0], wx.LOCALE_LOAD_DEFAULT)
		except KeyError:
			mylocale = wx.Locale (locales[u"en"][0], wx.LOCALE_LOAD_DEFAULT)

		langdir = os.path.join (core.system.getCurrentDir(), u'locale')
		Lang = gettext.translation(u'outwiker', langdir, languages=[language])
		Lang.install(unicode=1)

		if platform.system() == 'Linux':
			try:
				# to get some language settings to display properly:
				os.environ['LANG'] = locales[language][1]
			except (ValueError, KeyError):
				pass

	
	def getConfig (self):
		return self.config


	def OnInit(self):
		self.__initLocale()

		from gui.MainWindow import MainWindow
		wx.InitAllImageHandlers()
		mainWnd = MainWindow(None, -1, "")
		self.SetTopWindow(mainWnd)
		mainWnd.Show()
		return 1

# end of class OutWiker

if __name__ == "__main__":
	#print sys.argv[0]
	outwiker = OutWiker(0)
	outwiker.MainLoop()
